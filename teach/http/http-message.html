<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>http 报文结构 | 阿臻的博客</title><meta name="description" content="这是我的第一个 VuePress 站点">
    <link rel="preload" href="/assets/style-c0f6d13d.css" as="style"><link rel="stylesheet" href="/assets/style-c0f6d13d.css">
    <link rel="modulepreload" href="/assets/app-6cff156c.js"><link rel="modulepreload" href="/assets/http-message.html-e5930820.js"><link rel="modulepreload" href="/assets/http-message.html-08e11f64.js"><link rel="prefetch" href="/assets/index.html-5886ea47.js" as="script"><link rel="prefetch" href="/assets/Special-questions.html-41d28e2c.js" as="script"><link rel="prefetch" href="/assets/explore.html-f3dda06b.js" as="script"><link rel="prefetch" href="/assets/index.html-fd5f4fd2.js" as="script"><link rel="prefetch" href="/assets/axios-interceptor.html-52ce6f9c.js" as="script"><link rel="prefetch" href="/assets/css-interview.html-e8ba2a76.js" as="script"><link rel="prefetch" href="/assets/handwriting-bind-call.html-208f4b65.js" as="script"><link rel="prefetch" href="/assets/handwriting-promise.html-b74572cc.js" as="script"><link rel="prefetch" href="/assets/js-fundamentals.html-35fb87c0.js" as="script"><link rel="prefetch" href="/assets/microtask-event-queue.html-b9132fba.js" as="script"><link rel="prefetch" href="/assets/proxy-simple.html-f389c593.js" as="script"><link rel="prefetch" href="/assets/semantic.html-a2a66057.js" as="script"><link rel="prefetch" href="/assets/rollup-alias.html-891580eb.js" as="script"><link rel="prefetch" href="/assets/unocss-px-rpx.html-11b178e8.js" as="script"><link rel="prefetch" href="/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/assets/index.html-1de24fc4.js" as="script"><link rel="prefetch" href="/assets/Special-questions.html-9671173a.js" as="script"><link rel="prefetch" href="/assets/explore.html-3731525c.js" as="script"><link rel="prefetch" href="/assets/index.html-a118c222.js" as="script"><link rel="prefetch" href="/assets/axios-interceptor.html-dd23bcc8.js" as="script"><link rel="prefetch" href="/assets/css-interview.html-31f9604d.js" as="script"><link rel="prefetch" href="/assets/handwriting-bind-call.html-54081697.js" as="script"><link rel="prefetch" href="/assets/handwriting-promise.html-79947e57.js" as="script"><link rel="prefetch" href="/assets/js-fundamentals.html-50bca2bc.js" as="script"><link rel="prefetch" href="/assets/microtask-event-queue.html-f8f52ec8.js" as="script"><link rel="prefetch" href="/assets/proxy-simple.html-f9904579.js" as="script"><link rel="prefetch" href="/assets/semantic.html-82245e9e.js" as="script"><link rel="prefetch" href="/assets/rollup-alias.html-3abccb2c.js" as="script"><link rel="prefetch" href="/assets/unocss-px-rpx.html-27c230a7.js" as="script"><link rel="prefetch" href="/assets/404.html-ed9ebbeb.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="阿臻的博客"><span class="site-name can-hide">阿臻的博客</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/teach/utils/rollup-alias.md" class="router-link-active" aria-label="技术"><!--[--><!--]--> 技术 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/english/Special-questions.md" class="" aria-label="英语"><!--[--><!--]--> 英语 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/Journey98/blog" rel="noopener noreferrer" target="_blank" aria-label="github"><!--[--><!--]--> github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/teach/utils/rollup-alias.md" class="router-link-active" aria-label="技术"><!--[--><!--]--> 技术 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/english/Special-questions.md" class="" aria-label="英语"><!--[--><!--]--> 英语 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/Journey98/blog" rel="noopener noreferrer" target="_blank" aria-label="github"><!--[--><!--]--> github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/teach/utils/unocss-px-rpx.md" class="sidebar-item sidebar-heading" aria-label="unocss单位px转rpx,适配uniapp"><!--[--><!--]--> unocss单位px转rpx,适配uniapp <!--[--><!--]--></a><!----></li><li><a href="/teach/utils/rollup-alias.md" class="sidebar-item sidebar-heading" aria-label="rollup别名插件匹配原理"><!--[--><!--]--> rollup别名插件匹配原理 <!--[--><!--]--></a><!----></li><li><a href="/teach/http/http-message.md" class="sidebar-item sidebar-heading active" aria-label="http报文结构"><!--[--><!--]--> http报文结构 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">js基础 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/teach/base/handwriting-promise.md" class="sidebar-item" aria-label="手写promise"><!--[--><!--]--> 手写promise <!--[--><!--]--></a><!----></li><li><a href="/teach/base/semantic.md" class="sidebar-item" aria-label="标签语义化"><!--[--><!--]--> 标签语义化 <!--[--><!--]--></a><!----></li><li><a href="/teach/base/css-interview.md" class="sidebar-item" aria-label="css面试题"><!--[--><!--]--> css面试题 <!--[--><!--]--></a><!----></li><li><a href="/teach/base/js-fundamentals.md" class="sidebar-item" aria-label="js基础"><!--[--><!--]--> js基础 <!--[--><!--]--></a><!----></li><li><a href="/teach/base/handwriting-bind-call.md" class="sidebar-item" aria-label="手写bind-call"><!--[--><!--]--> 手写bind-call <!--[--><!--]--></a><!----></li><li><a href="/teach/base/microtask-event-queue.md" class="sidebar-item" aria-label="微任务,事件队列"><!--[--><!--]--> 微任务,事件队列 <!--[--><!--]--></a><!----></li><li><a href="/teach/base/axios-interceptor.md" class="sidebar-item" aria-label="关于axios拦截器的实现"><!--[--><!--]--> 关于axios拦截器的实现 <!--[--><!--]--></a><!----></li><li><a href="/teach/base/proxy-simple.md" class="sidebar-item" aria-label="proxy 简单依赖收集"><!--[--><!--]--> proxy 简单依赖收集 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="http-报文结构" tabindex="-1"><a class="header-anchor" href="#http-报文结构" aria-hidden="true">#</a> http 报文结构</h1><p><code>起始行 + 头部 + 空行 + 实体</code></p><h2 id="请求报文" tabindex="-1"><a class="header-anchor" href="#请求报文" aria-hidden="true">#</a> 请求报文</h2><p>起始行结构: 方法 + 路径 + http 版本</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>POST /mock/ebd9fdbd926cb76a6bcc60a60cb8b20b/api/dms/user/login HTTP/1.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>头部就是请求头里面的一些选项,内容比较多,这里就不一一赘述了</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>Accept: application/json, */*
Content-Type: application/json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>空行是 请求头和实体(请求参数)的分割线</p><p><a href="#%E7%A9%BA%E8%A1%8C%E4%BD%9C%E7%94%A8">空行作用</a></p><p>实体是请求参数,请求 body</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>// post
{&#39;name&#39;:&#39;张三&#39;}
// get
 xxxx.com?name=gaoyuanyuan
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>整体示例</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>POST /mock/ebd9fdbd926cb76a6bcc60a60cb8b20b/api/dms/user/login HTTP/1.1
Accept: application/json, */*
Content-Type: application/json

{&#39;name&#39;:&#39;张三&#39;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://i.loli.net/2021/09/03/oBm7nljOkeiHrpg.png" alt="image.png"></p><h2 id="响应报文" tabindex="-1"><a class="header-anchor" href="#响应报文" aria-hidden="true">#</a> 响应报文</h2><p>起始行结构: http 版本 + 状态码 + 原因</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>HTTP/1.1 200 OK
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>响应头部</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>Access-Control-Allow-Credentials: true
Access-Control-Allow-Origin: https://www.fastmock.site
Connection: keep-alive
Content-Length: 80
Content-Type: application/json; charset=utf-8
Date: Fri, 03 Sep 2021 06:01:17 GMT
Etag: W/&quot;50-8fTCRozfmd5gGhhiwMsWgIeuEPo&quot;
Server: nginx/1.17.8
Vary: Accept, Origin, Accept-Encoding
X-Powered-By: Express
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>空行是响应和实体(响应数据)的分割线。</p><p><a href="#%E7%A9%BA%E8%A1%8C%E4%BD%9C%E7%94%A8">空行作用</a></p><p>实体就是响应体,body</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>{
  &quot;code&quot;: 0,
  &quot;data&quot;: {
    &quot;access_token&quot;: &quot;editor-token&quot;,
    &quot;refresh_token&quot;: &quot;editor-token&quot;
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>完整示例</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>HTTP/1.1 200 OK
Access-Control-Allow-Credentials: true
Access-Control-Allow-Origin: https://www.fastmock.site
Connection: keep-alive
Content-Length: 80
Content-Type: application/json; charset=utf-8
Date: Fri, 03 Sep 2021 06:01:17 GMT
Etag: W/&quot;50-8fTCRozfmd5gGhhiwMsWgIeuEPo&quot;
Server: nginx/1.17.8
Vary: Accept, Origin, Accept-Encoding
X-Powered-By: Express

{
  &quot;code&quot;: 0,
  &quot;data&quot;: {
    &quot;access_token&quot;: &quot;editor-token&quot;,
    &quot;refresh_token&quot;: &quot;editor-token&quot;
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://i.loli.net/2021/09/03/Ee67VSCXLr2isQc.png" alt="image.png"></p><h3 id="起始行" tabindex="-1"><a class="header-anchor" href="#起始行" aria-hidden="true">#</a> 起始行</h3><p>值得注意的是，在起始行中，每两个部分之间用空格隔开，最后一个部分后面应该接一个换行，严格遵循 ABNF 语法规范。</p><h3 id="空行作用" tabindex="-1"><a class="header-anchor" href="#空行作用" aria-hidden="true">#</a> 空行作用</h3><p>如果说在头部中间故意加一个空行会怎么样？那么空行后的内容全部被视为实体。</p><h1 id="http-状态码" tabindex="-1"><a class="header-anchor" href="#http-状态码" aria-hidden="true">#</a> http 状态码</h1><p>RFC 规定 HTTP 的状态码为三位数,被分为五类:</p><ul><li>1xx: 表示目前是协议处理的中间状态,还需要后续操作。</li><li>2xx: 表示成功状态</li><li>3xx: 重定向状态,资源位置发生变动,需要重新请求</li><li>4xx: 请求报文错误</li><li>5xx: 服务端发生错误</li></ul><h2 id="_1xx" tabindex="-1"><a class="header-anchor" href="#_1xx" aria-hidden="true">#</a> 1xx</h2><p>101 switching Protocol。在 HTTP 升级为 websocket 的时候，如果服务器同意变更，就会发送状态吗 101</p><h2 id="_2xx" tabindex="-1"><a class="header-anchor" href="#_2xx" aria-hidden="true">#</a> 2xx</h2><p>200 是成功的状态,通常响应体中会有数据</p><p>204 No content 成功,但是响应体里面没有内容</p><p>206 <code>Partial Content</code> 顾名思义,表示部分内容,使用场景是 <code>HTTP</code>分块下载和断点续传, 响应头字段 <code>Content-Range</code></p><h2 id="_3xx" tabindex="-1"><a class="header-anchor" href="#_3xx" aria-hidden="true">#</a> 3xx</h2><p>301 Moved Permanently 永久重定向,对应着 302 Found, 即临时重定向。</p><p>302 Found 临时重定向</p><p>网站从 http 升级为 https,以前的站点不用了,应当返回 301,浏览器会做缓存优化,在第二次访问 http 地址的时候自动访问重定向的 https 地址</p><p>如果只是暂时不用,可以返回 302 即可, 302 浏览器不会做缓存优化</p><p>304 Not Modified 协商缓存命中时会返回这个状态码。</p><p>客户端怎么知道有没有修改,这是个服务端的事情</p><h2 id="_4xx" tabindex="-1"><a class="header-anchor" href="#_4xx" aria-hidden="true">#</a> 4xx</h2><p>400 Bad Request: 最有可能的错误是请求方法弄错了, 比如: get 方法用成了 post 这是我的经验,哈哈</p><p>403 Forbidden: 服务器禁止访问,原因很多,比如法律禁止、信息敏感等</p><p>404 Not Found: 资源未找到,表示没在服务器上找到相应的资源。</p><p>405 Method Not Allowed: 请求方法不被服务端允许</p><p>406 Not Acceptable: 资源无法满足客户端的条件。</p><p>408 Request Timeout: 服务器等待了太长时间</p><p>409 Conflict: 多个请求发生了冲突</p><p>413 Request Entity Too Large: 请求体的数据过大</p><p>414 Request-URL Too Long: 请求过多。</p><p>429 Too Many Request: 客户端发送的请求过多</p><p>431 Request Header Fields Too Large 请求头的字段内容过大</p><h2 id="_5xx" tabindex="-1"><a class="header-anchor" href="#_5xx" aria-hidden="true">#</a> 5xx</h2><p>500 Internal Server Error:仅仅告诉你服务器出错了,啥错咱不知道,找后端就对了</p><p>501 Not Implemented: 表示客户端请求的功能还不支持</p><p>502 Bad GateWay:服务器自身是正常的,但访问的时候出错了,啥错误咱也不知道,单词的意思就是网关</p><p>503 Service Unavailable:表示服务器当前很忙, 暂时无法响应服务</p><h1 id="浏览器输入-url-发生了什么" tabindex="-1"><a class="header-anchor" href="#浏览器输入-url-发生了什么" aria-hidden="true">#</a> 浏览器输入 url 发生了什么</h1><p>DNS 解析 =&gt; TCP 连接 =&gt; 发送 http 请求 =&gt; 关闭 TCP 连接 =&gt; 浏览器渲染</p><h2 id="dns-解析" tabindex="-1"><a class="header-anchor" href="#dns-解析" aria-hidden="true">#</a> DNS 解析</h2><p>域名系统（英文：Domain Name System，缩写：DNS）是互联网的一项服务。它作为将域名和 IP 地址相互映射的一个分布式数据库，能够使人更方便地访问互联网。树状结构</p><p>域名和 IP 的关系 = 小红和家庭地址的关系</p><p>通俗点讲就是说 DNS 就是一个地址簿,比如你有很多朋友,小明,小红,小刚等等,你很容易就叫出这些名字,但是让你说出小红家在哪,很难马上说出来吧,此时地址簿的用处就出现了,在上面查到地址就可以去了</p><p><img src="https://i.loli.net/2021/09/06/fJuNHVBpDkCnLms.png" alt="image.png"></p><ol><li>root 级 DNS 服务器=&gt;顶级域名 DNS 服务器的 ip 地址</li><li>顶级域 DNS 服务器=&gt;权威域名 DNS 服务器的 ip 地址</li><li>权威域名服务器=&gt;请求的主机的 ip 地址</li></ol><h3 id="dns-的域名查找" tabindex="-1"><a class="header-anchor" href="#dns-的域名查找" aria-hidden="true">#</a> DNS 的域名查找</h3><p>客户端和浏览器端,本地 DNS 之间的查询方式是递归查询;只要其中一环找到结果就会都会结束查找流程</p><p><img src="https://i.loli.net/2021/09/06/9VOyDpFiAgdzLtN.png" alt="image.png"></p><p>本地 DNS 服务器与根域和其子域名之间的查询方式是迭代查询,若未用转发模式，则迭代查找过程如下图：</p><p><img src="https://i.loli.net/2021/09/06/Q4Xbz5rGlwg8SBo.png" alt="image.png"></p><p><a href="https://www.huaweicloud.com/articles/12529141.html" target="_blank" rel="noopener noreferrer">关于转发模式的解释<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>优化处理</p><ul><li>DNS 存在这多级缓存,浏览器缓存,DNS 缓存,路由器缓存,IPS 服务器缓存,根域名服务器缓存,顶级域名服务器缓存,主域名服务器缓存</li><li>域名和 ip 映射的过程中,有了做均衡负载的机会,可以是简单的均衡负载,也可以是根据地址和运营商的全局负载均衡</li></ul><h2 id="建立-tcp-连接" tabindex="-1"><a class="header-anchor" href="#建立-tcp-连接" aria-hidden="true">#</a> 建立 TCP 连接</h2><p>首先,判断是不是 https 的,如果是,https 其实是 http + ssl / Tls ,在 http 上加上一层处理加密信息的模块。服务端和客户端的信息传输都会通过 TLS 进行加密，所以传输的数据都是加密的数据</p><p>三次握手</p><ol><li><p>第一次握手 建立连接。客户端发送请求报文段，将 SYN 位置为 1, sequence Number 为 x; 然后, 客户端进入 SYN_SEND 状态, 等待服务器的确认</p></li><li><p>第二次握手 服务器收到 SYN 报文段,服务器收到客户端的 SYN 报文段,需要对这个报文段进行确认,设置 Acknowledgment Number 为 x + 1; 同时, 自己还要发送 SYN 消息, Sequence Number 为 y ; 服务端将上述所有信息放到一个报文段(SYN + ACK 报文段) 中, 一并发给客户端, 此时服务器进入 SYN_RECV 状态</p></li><li><p>第三次握手 客户端收到 SYN + ACK 报文段。然后 Acknowledgment Number 设置为 y + 1, 向服务器发送 ACK 字段, 这个报文段发送完毕以后, 客户端和服务端都进入 ESTABLISHED 状态, 完成 TCP 三次状态</p></li></ol><p><img src="https://user-images.githubusercontent.com/52627267/132192933-eb1bfe31-d8d5-4d6e-8eff-8a9c0f145366.jpg" alt="1630919634(1)"></p><p>SSL 握手过程</p><ol><li>第一阶段 建立安全能力,协议版本,会话 ID 密码构件,压缩方法和初始随机数</li><li>第二阶段 服务器发送证书, 密匙交换数据和证书请求,最后发送请求-相应阶段的结束信号</li><li>第三阶段 如果有证书,请求客户端发送证书,之后客户端发送密匙交换数据,也可以发送证书验证消息</li><li>第四阶段 变更密码构件和结束握手协议</li></ol><p>完成之后就可以开始数据传输了</p><blockquote><p>ACK: 即确认字符, 在数据通信中, 接收站发给发送站的一种传输类控制字符, 表示发来的数据已经确认接收无误有两个取值：0 和 1，为 1 的时候表示应答域有效，反之为 0。TCP 协议规定，只有 ACK=1 时有效，也规定连接建立后所有发送的报文的 ACK 必须为 1</p></blockquote><blockquote><p>SYN(SYNchronization): 在建立连接时用的同步序号, 是建立连接时使用的握手信号。当 SYN=1 而 ACK=0 时，表明这是一个连接请求报文。对方若同意建立连接，则应在响应报文中使 SYN=1 和 ACK=1. 因此, SYN 置 1 就表示这是一个连接请求或连接接受报文。</p></blockquote><blockquote><p>FIN(finis）即完，终结的意思， 用来释放一个连接。当 FIN = 1 时，表明此报文段的发送方的数据已经发送完毕，并要求释放连接。</p></blockquote><p><a href="https://baike.baidu.com/item/ACK/3692629?fr=aladdin" target="_blank" rel="noopener noreferrer">相关解释<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="发送-http-请求-服务器处理请求-返回响应结果" tabindex="-1"><a class="header-anchor" href="#发送-http-请求-服务器处理请求-返回响应结果" aria-hidden="true">#</a> 发送 http 请求, 服务器处理请求, 返回响应结果</h2><p>TCP 连接建立后, http / https 就可以发送请求, 服务器接受到请求, 就解析请求头, 如果头部有缓存信息如: <code>If-None-Match</code> 或者 <code>If-Modified-Since</code> 就会判断缓存是否有效, 有效就返回 304, 无效就重新返回资源 200</p><p>浏览器缓存，也称 Http 缓存，分为强缓存和协商缓存。优先级较高的是强缓存，在命中强缓存失败的情况下，才会走协商缓存。</p><blockquote><p><img src="https://cdn.jsdelivr.net/gh/azhen98/A-week-to-learn@assert/image/surprise.png" alt="surprise"> 今天偶然间学到的小知识点 <code>.at</code> 支持字符串和数组</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
arr<span class="token punctuation">[</span>arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// 5</span>
arr<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//1</span>
<span class="token string">&#39;AB&#39;</span><span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// A</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>数据传输完毕之后, 双方都可以释放连接, 双方都处于 established 状态, 然后客户端主动关闭, 服务器被动关闭</p></blockquote><p>由于 TCP 连接是全双工的，因此每个方向都必须单独进行关闭。这原则是当一方完成它的数据发送任务后就能发送一个 FIN 来终止这个方向的连接。收到一个 FIN 只意味着这一方向上没有数据流动，一个 TCP 连接在收到一个 FIN 后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。</p><p>（1） TCP 客户端发送一个 FIN，用来关闭客户到服务器的数据传送。</p><p>（2） 服务器收到这个 FIN，它发回一个 ACK，确认序号为收到的序号加 1。和 SYN 一样，一个 FIN 将占用一个序号。</p><p>（3） 服务器关闭客户端的连接，发送一个 FIN 给客户端。</p><p>（4） 客户端发回 ACK 报文确认，并将确认序号设置为收到序号加 1。</p><p><img src="https://cdn.jsdelivr.net/gh/azhen98/A-week-to-learn@assert/image/20210907151926.png" alt="20210907151926"></p><p>为什么是四次挥手, 三次握手</p><p>在建立链接的时候, 服务器在 listen 状态, 收到建立请求的 SYN 的报文后, 把 ACK 和 SYN 放到一个报文里发送给客户端</p><p>关闭连接的时候, 服务器收到 FIN 报文时, 仅仅表示对方不会再发送数据, 但是还能接收数据, 而且自己的数据也不一定全部发送完成了, 所以己方可以立即关闭, 也可以发送一些数据给对方后, 再发送 FIN 报文告诉对方来表示同意关闭连接, 因此己方 ACK 和 FIN 会分开发送, 从而导致多了一次</p><p>客户端等待 2MLS</p><p>MSL（Maximum Segment Lifetime）报文最大生存时间</p><p>当服务器发送请求断开的报文时(客户端收到状态改为 Time-wait), 但是服务端没有收到客户端的响应, 就可以在 2MSL 时间内再次发生断开报文, 客户端收到这个重传的报文, 接着发出回应报文, 客户端发出报文后, 重新计算 2MSL</p><h1 id="关于-cookie-samesite-属性" tabindex="-1"><a class="header-anchor" href="#关于-cookie-samesite-属性" aria-hidden="true">#</a> 关于 cookie SameSite 属性</h1><p>SameSite 属性是 HTTP 响应头 set-cookie 的属性之一。 他允许声明该 cookie 是否仅限于第一方或者同一站点使用</p><h2 id="samesite-的三个属性" tabindex="-1"><a class="header-anchor" href="#samesite-的三个属性" aria-hidden="true">#</a> SameSite 的三个属性</h2><h3 id="_1-lax-cookies-允许与顶级导航一起发送-并将与第三方网站发起的-get-请求-一起发送。" tabindex="-1"><a class="header-anchor" href="#_1-lax-cookies-允许与顶级导航一起发送-并将与第三方网站发起的-get-请求-一起发送。" aria-hidden="true">#</a> 1. Lax Cookies 允许与顶级导航一起发送，并将与第三方网站发起的 <strong>GET 请求</strong> 一起发送。</h3><table><thead><tr><th>请求类型</th><th>示例</th><th>正常情况</th><th>Lax</th></tr></thead><tbody><tr><td>链接</td><td><code>&lt;a href=&quot;...&quot;&gt;&lt;/a&gt;</code></td><td>发送 Cookie</td><td>发送 Cookie</td></tr><tr><td>预加载</td><td><code>&lt;link rel=&quot;prerender&quot; href=&quot;...&quot;/&gt;</code></td><td>发送 Cookie</td><td>发送 Cookie</td></tr><tr><td>GET 表单</td><td><code>&lt;form method=&quot;GET&quot; action=&quot;...&quot;&gt;</code></td><td>发送 Cookie</td><td>发送 Cookie</td></tr><tr><td>POST 表单</td><td><code>&lt;form method=&quot;POST&quot; action=&quot;...&quot;&gt;</code></td><td>发送 Cookie</td><td>不发送</td></tr><tr><td>iframe</td><td><code>&lt;iframe src=&quot;...&quot;&gt;&lt;/iframe&gt;</code></td><td>发送 Cookie</td><td>不发送</td></tr><tr><td>AJAX</td><td><code>$.get(&quot;...&quot;)</code></td><td>发送 Cookie</td><td>不发送</td></tr><tr><td>Image</td><td><code>&lt;img src=&quot;...&quot;&gt;</code></td><td>发送 Cookie</td><td>不发送</td></tr></tbody></table><h3 id="_2-strict-只能第一方使用-自己的的-cookie-只能自己用-亲戚朋友都不行" tabindex="-1"><a class="header-anchor" href="#_2-strict-只能第一方使用-自己的的-cookie-只能自己用-亲戚朋友都不行" aria-hidden="true">#</a> 2. Strict 只能第一方使用 自己的的 cookie 只能自己用,亲戚朋友都不行</h3><h3 id="_3-none-所有上下文都可以使用-允许跨域使用" tabindex="-1"><a class="header-anchor" href="#_3-none-所有上下文都可以使用-允许跨域使用" aria-hidden="true">#</a> 3. none 所有上下文都可以使用 允许跨域使用</h3><p>无效设置( SameSite=None 但未标记 Secure 的任何 cookie 都将被拒绝。)</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> widget_session<span class="token operator">=</span>abc123<span class="token punctuation">;</span> SameSite<span class="token operator">=</span>None
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>有效设置</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> widget_session<span class="token operator">=</span>abc123<span class="token punctuation">;</span> SameSite<span class="token operator">=</span>None<span class="token punctuation">;</span> Secure
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>不设置 SameSite 属性 默认为 SameSite = Lax</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 15939054361@163.com">ccz</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-6cff156c.js" defer></script>
  </body>
</html>
